const Stripe=require('stripe');module.exports=async(req,res)=>{try{if(req.method!=='POST')return res.status(405).json({error:'Method not allowed'});const stripeKey=process.env.STRIPE_SECRET_KEY;if(!stripeKey)return res.status(500).json({error:'Stripe key missing'});const stripe=new Stripe(stripeKey);const mode=req.body?.mode==='subscription'?'subscription':'payment';const priceId=mode==='subscription'?process.env.STRIPE_SUBSCRIPTION_PRICE_ID:process.env.STRIPE_ONEOFF_PRICE_ID;const session=await stripe.checkout.sessions.create({mode,payment_method_types:['card'],line_items:[{price:priceId,quantity:1}],success_url:`${process.env.NEXT_PUBLIC_APP_URL||'https://example.com'}/success`,cancel_url:`${process.env.NEXT_PUBLIC_APP_URL||'https://example.com'}/cancel`});res.json({url:session.url});}catch(e){console.error(e);res.status(500).json({error:e.message});}}