const AWS=require('aws-sdk');module.exports=async(req,res)=>{try{if(req.method!=='POST')return res.status(405).json({error:'Method not allowed'});const {filename,contentType}=req.body||{};if(!filename||!contentType)return res.status(400).json({error:'filename/contentType required'});const s3=new AWS.S3({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,region:process.env.AWS_REGION,signatureVersion:'v4'});const Key=`uploads/${Date.now()}_${filename}`;const params={Bucket:process.env.S3_BUCKET_NAME,Key,Expires:60,ContentType:contentType};const uploadUrl=await s3.getSignedUrlPromise('putObject',params);res.json({uploadUrl,key:Key});}catch(e){console.error('presign error',e);res.status(500).json({error:e.message});}}